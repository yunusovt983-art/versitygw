# –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ PlantUML —Ñ–∞–π–ª–æ–≤ Task1

–î–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö PlantUML –¥–∏–∞–≥—Ä–∞–º–º, —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –¥–ª—è Task1 - Enhanced Cache System.

## üìã –û–±–∑–æ—Ä PlantUML —Ñ–∞–π–ª–æ–≤

–í –ø–∞–ø–∫–µ `doc` –Ω–∞—Ö–æ–¥—è—Ç—Å—è 3 –æ—Å–Ω–æ–≤–Ω—ã—Ö PlantUML —Ñ–∞–π–ª–∞:

1. **`task1_c4_architecture.puml`** - C4 –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã
2. **`task1_cache_detailed_architecture.puml`** - –î–µ—Ç–∞–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫—ç—à–∞
3. **`task1_data_flow_diagrams.puml`** - –î–∏–∞–≥—Ä–∞–º–º—ã –ø–æ—Ç–æ–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö

---

## 1. üìê task1_c4_architecture.puml

### –û–ø–∏—Å–∞–Ω–∏–µ
–≠—Ç–æ—Ç —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–Ω—É—é C4 –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Å–∏—Å—Ç–µ–º—ã enhanced caching —Å–æ–≥–ª–∞—Å–Ω–æ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏ C4 Model (Context, Containers, Components, Code).

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–∞

#### üåç Level 1: System Context Diagram
```plantuml
Person(user, "S3 Client", "Applications using S3 API")
System(gateway, "Versity S3 Gateway", "S3-compatible gateway with enhanced authentication caching")
System_Ext(iam_services, "External IAM Services", "LDAP, Vault, S3, IPA services")
```

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:**
- **Person(user)** - –í–Ω–µ—à–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—ã, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ S3 API
- **System(gateway)** - –û—Å–Ω–æ–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ Versity S3 Gateway
- **System_Ext(iam_services)** - –í–Ω–µ—à–Ω–∏–µ IAM —Å–µ—Ä–≤–∏—Å—ã (LDAP, Vault, etc.)

**–¶–µ–ª—å:** –ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å–∏—Å—Ç–µ–º—ã –∏ –µ—ë –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –≤–Ω–µ—à–Ω–∏–º –º–∏—Ä–æ–º.

#### üèóÔ∏è Level 2: Container Diagram
```plantuml
Container(s3_api, "S3 API Layer", "Go", "Handles S3 protocol requests")
Container(auth_system, "Enhanced Auth System", "Go", "Authentication with advanced caching")
Container(storage_layer, "Storage Layer", "Go", "Object storage operations")
```

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:**
- **s3_api** - –°–ª–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ S3 –ø—Ä–æ—Ç–æ–∫–æ–ª–∞
- **auth_system** - ‚≠ê –ù–∞—à–∞ enhanced —Å–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (Task1)
- **storage_layer** - –°–ª–æ–π —Ä–∞–±–æ—Ç—ã —Å –æ–±—ä–µ–∫—Ç–Ω—ã–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º

**–¶–µ–ª—å:** –ü–æ–∫–∞–∑–∞—Ç—å –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –∏—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏.

#### üîß Level 3: Component Diagram
```plantuml
Component(enhanced_iam_cache, "Enhanced IAM Cache", "Go Struct", "Main caching layer with fallback support")
Component(enhanced_cache, "Enhanced Cache Core", "Go Struct", "LRU cache with TTL and invalidation")
Component(fallback_cache, "Fallback Cache", "Go Struct", "Emergency cache for service outages")
```

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:**
- **enhanced_iam_cache** - –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è IAM
- **enhanced_cache** - –Ø–¥—Ä–æ –∫—ç—à–∞ —Å LRU –∏ TTL
- **fallback_cache** - –†–µ–∑–µ—Ä–≤–Ω—ã–π –∫—ç—à –¥–ª—è –∞–≤–∞—Ä–∏–π–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π

**–¶–µ–ª—å:** –î–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É Enhanced Auth System.

#### üíª Level 4: Code Diagram
```plantuml
class EnhancedCache {
    +Get(key, entryType) (interface{}, bool)
    +Set(key, value, ttl, entryType)
    +Invalidate(pattern) error
    +evictLRU()
}
```

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:**
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –∫–ª–∞—Å—Å—ã –∏ –º–µ—Ç–æ–¥—ã
- –î–µ—Ç–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏ –∏—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- –î–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç —Å–≤—è–∑–∏ –º–µ–∂–¥—É –∫–ª–∞—Å—Å–∞–º–∏

**–¶–µ–ª—å:** –ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–¥-—É—Ä–æ–≤–µ–Ω—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤.

#### üöÄ Deployment Diagram
```plantuml
Deployment_Node(server, "Application Server", "Linux Server") {
    Deployment_Node(go_runtime, "Go Runtime", "Go 1.21+") {
        Container(gateway_app, "Versity S3 Gateway", "Go Application")
    }
}
```

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:**
- **server** - –§–∏–∑–∏—á–µ—Å–∫–∏–π/–≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä
- **go_runtime** - –°—Ä–µ–¥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è Go
- **gateway_app** - –†–∞–∑–≤–µ—Ä–Ω—É—Ç–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

**–¶–µ–ª—å:** –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–∏–∑–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã.

#### üîÑ Sequence Diagrams
```plantuml
client -> api: S3 Request with credentials
api -> cache: GetUserAccount(access_key)
cache -> primary: Get("user:access_key", UserCredentials)
```

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:**
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—É—é –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π
- –î–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø–æ—Ç–æ–∫ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –í–∫–ª—é—á–∞–µ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–∏ cache hit/miss –∏ fallback

**–¶–µ–ª—å:** –û–±—ä—è—Å–Ω–∏—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã.

### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ñ–∞–π–ª–∞

1. **–ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ—Å—Ç—å** - –û—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–æ –∫–æ–¥–∞
2. **–ü–æ–ª–Ω–æ—Ç–∞** - –í—Å–µ –∞—Å–ø–µ–∫—Ç—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
3. **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å** - Sequence –¥–∏–∞–≥—Ä–∞–º–º—ã –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –ø–æ—Ç–æ–∫–æ–≤
4. **–ü—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å** - Deployment –¥–ª—è DevOps

---

## 2. üîç task1_cache_detailed_architecture.puml

### –û–ø–∏—Å–∞–Ω–∏–µ
–≠—Ç–æ—Ç —Ñ–∞–π–ª —Ñ–æ–∫—É—Å–∏—Ä—É–µ—Ç—Å—è –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –Ω–∞ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ —Å–∏—Å—Ç–µ–º—ã –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è, –ø–æ–∫–∞–∑—ã–≤–∞—è –≤—Å–µ –∫–ª–∞—Å—Å—ã, –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏ –∏—Ö –≤–∑–∞–∏–º–æ—Å–≤—è–∑–∏.

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–∞

#### üìä Cache Entry Types
```plantuml
enum CacheEntryType {
    UserCredentials (TTL: 15min)
    UserRoles (TTL: 30min)
    Permissions (TTL: 1hour)
    MFASettings (TTL: 2hours)
    SessionData (TTL: 10min)
}
```

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:**
- **Enum** –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø—ã –∫—ç—à–∏—Ä—É–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **TTL –∑–Ω–∞—á–µ–Ω–∏—è** –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- **–¢–∏–ø–∏–∑–∞—Ü–∏—è** –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

**–¶–µ–ª—å:** –ü–æ–∫–∞–∑–∞—Ç—å —Å–∏—Å—Ç–µ–º—É —Ç–∏–ø–æ–≤ –∫—ç—à–∞ –∏ –∏—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏.

#### üèóÔ∏è Core Cache Structures
```plantuml
class CacheEntry {
    -value: interface{}
    -expiry: time.Time
    -entryType: CacheEntryType
    -accessTime: time.Time
    -key: string
    +isExpired(): bool
    +touch(): void
}
```

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:**
- **value** - –•—Ä–∞–Ω–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ (–ª—é–±–æ–π —Ç–∏–ø)
- **expiry** - –í—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏
- **entryType** - –¢–∏–ø –∑–∞–ø–∏—Å–∏ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- **accessTime** - –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –¥–æ—Å—Ç—É–ø–∞ (–¥–ª—è LRU)
- **key** - –ö–ª—é—á –∑–∞–ø–∏—Å–∏
- **isExpired()** - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è
- **touch()** - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ—Å—Ç—É–ø–∞

**–¶–µ–ª—å:** –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö –∫—ç—à-–∑–∞–ø–∏—Å–∏.

#### ‚öôÔ∏è Enhanced Cache Core
```plantuml
class EnhancedCache {
    -entries: map[string]*CacheEntry
    -maxSize: int
    -fallbackMode: bool
    -stats: CacheStats
    -defaultTTLs: map[CacheEntryType]time.Duration
    -mu: sync.RWMutex
    -cancel: context.CancelFunc
}
```

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:**
- **entries** - –û—Å–Ω–æ–≤–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∫—ç—à-–∑–∞–ø–∏—Å–µ–π
- **maxSize** - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∫—ç—à–∞
- **fallbackMode** - –§–ª–∞–≥ —Ä–µ–∂–∏–º–∞ fallback
- **stats** - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **defaultTTLs** - TTL –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è —Ç–∏–ø–æ–≤
- **mu** - –ú—å—é—Ç–µ–∫—Å –¥–ª—è thread-safety
- **cancel** - –ö–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è graceful shutdown

**–¶–µ–ª—å:** –ü–æ–∫–∞–∑–∞—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫—ç—à–∞.

#### üîÑ IAM Cache Wrapper
```plantuml
class EnhancedIAMCache {
    -service: IAMService
    -cache: EnhancedCache
    -fallbackCache: EnhancedCache
}
```

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:**
- **service** - –ë–∞–∑–æ–≤—ã–π IAM —Å–µ—Ä–≤–∏—Å
- **cache** - –û—Å–Ω–æ–≤–Ω–æ–π –∫—ç—à
- **fallbackCache** - –†–µ–∑–µ—Ä–≤–Ω—ã–π –∫—ç—à

**–¶–µ–ª—å:** –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –∫—ç—à–∞ —Å IAM —Å–∏—Å—Ç–µ–º–æ–π.

#### üìã Configuration Classes
```plantuml
class EnhancedCacheConfig {
    +MaxSize: int
    +CleanupInterval: time.Duration
    +DefaultTTLs: map[CacheEntryType]time.Duration
}
```

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:**
- **MaxSize** - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∫—ç—à–∞
- **CleanupInterval** - –ò–Ω—Ç–µ—Ä–≤–∞–ª –æ—á–∏—Å—Ç–∫–∏
- **DefaultTTLs** - TTL –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

**–¶–µ–ª—å:** –ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Å–∏—Å—Ç–µ–º—ã.

#### üîó Relationships
```plantuml
EnhancedCache ..|> EnhancedCacheInterface
EnhancedIAMCache ..|> IAMService
EnhancedIAMCache --> EnhancedCache : primary cache
EnhancedIAMCache --> EnhancedCache : fallback cache
```

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:**
- **Implements (..|>)** - –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
- **Uses (-->)** - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- **Composition** - –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ —Å–≤—è–∑–∏

**–¶–µ–ª—å:** –ü–æ–∫–∞–∑–∞—Ç—å —Å–≤—è–∑–∏ –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏.

### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ñ–∞–π–ª–∞

1. **–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è** - –í—Å–µ –ø–æ–ª—è –∏ –º–µ—Ç–æ–¥—ã –∫–ª–∞—Å—Å–æ–≤
2. **–¢–∏–ø–∏–∑–∞—Ü–∏—è** - –°—Ç—Ä–æ–≥–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ç–∏–ø–æ–≤
3. **–°–≤—è–∑–∏** - –ß–µ—Ç–∫–∏–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
4. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã

---

## 3. üåä task1_data_flow_diagrams.puml

### –û–ø–∏—Å–∞–Ω–∏–µ
–≠—Ç–æ—Ç —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç 6 –¥–µ—Ç–∞–ª—å–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è, –ø–æ–∫–∞–∑—ã–≤–∞—è –ø–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö.

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–∞

#### üéØ Scenario 1: Cache Hit Flow
```plantuml
client -> api: **S3 Request**\n(Access Key: "user123")
api -> iam_cache: **GetUserAccount("user123")**
iam_cache -> primary: **Get("user:user123", UserCredentials)**
primary -> primary: **Check expiry & type**
primary -> primary: **Update access time (LRU)**
primary -> stats: **Increment hits**
primary --> iam_cache: **Return Account{...}**
```

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–∞:**
1. **–ö–ª–∏–µ–Ω—Ç** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç S3 –∑–∞–ø—Ä–æ—Å —Å –∫–ª—é—á–æ–º –¥–æ—Å—Ç—É–ø–∞
2. **API —Å–ª–æ–π** –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. **IAM Cache** –∏—â–µ—Ç –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –∫—ç—à–µ
4. **Primary Cache** –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å –∏ —Ç–∏–ø –∑–∞–ø–∏—Å–∏
5. **LRU –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** - –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤—Ä–µ–º—è –¥–æ—Å—Ç—É–ø–∞
6. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è —Å—á–µ—Ç—á–∏–∫ –ø–æ–ø–∞–¥–∞–Ω–∏–π
7. **–í–æ–∑–≤—Ä–∞—Ç –¥–∞–Ω–Ω—ã—Ö** - –∞–∫–∫–∞—É–Ω—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫–ª–∏–µ–Ω—Ç—É

**–¶–µ–ª—å:** –ü–æ–∫–∞–∑–∞—Ç—å –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π —Å –ø–æ–ø–∞–¥–∞–Ω–∏–µ–º –≤ –∫—ç—à.

#### ‚ùå Scenario 2: Cache Miss - Service Available
```plantuml
iam_cache -> primary: **Get("user:newuser", UserCredentials)**
primary -> stats: **Increment misses**
primary --> iam_cache: **Not found**
iam_cache -> base_iam: **GetUserAccount("newuser")**
base_iam --> iam_cache: **Return Account{...}**
par Store in Primary Cache
    iam_cache -> primary: **Set("user:newuser", account, 15min, UserCredentials)**
    primary -> primary: **Check cache size**
    alt Cache full
        primary -> primary: **evictLRU()**
        primary -> stats: **Increment evictions**
    end
and Store in Fallback Cache
    iam_cache -> fallback: **Set("user:newuser", account, 60min, UserCredentials)**
end
```

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–∞:**
1. **Cache miss** - –∑–∞–ø–∏—Å—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ –∫—ç—à–µ
2. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è —Å—á–µ—Ç—á–∏–∫ –ø—Ä–æ–º–∞—Ö–æ–≤
3. **IAM –∑–∞–ø—Ä–æ—Å** - –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ –±–∞–∑–æ–≤–æ–º—É IAM —Å–µ—Ä–≤–∏—Å—É
4. **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ** - –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –∏ —Ä–µ–∑–µ—Ä–≤–Ω—ã–π –∫—ç—à
5. **LRU –ø—Ä–æ–≤–µ—Ä–∫–∞** - –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π
6. **–†–∞–∑–Ω—ã–µ TTL** - 15 –º–∏–Ω –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ, 60 –º–∏–Ω –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ

**–¶–µ–ª—å:** –ü–æ–∫–∞–∑–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –ø—Ä–æ–º–∞—Ö–∞ –∫—ç—à–∞ –ø—Ä–∏ –¥–æ—Å—Ç—É–ø–Ω–æ–º —Å–µ—Ä–≤–∏—Å–µ.

#### üö® Scenario 3: Fallback Mechanism
```plantuml
iam_cache -> base_iam: **GetUserAccount("user123")**
base_iam --> iam_cache: **Error: Service Unavailable**
iam_cache -> fallback: **Get("user:user123", UserCredentials)**
fallback -> fallback: **Check if entry exists**
fallback --> iam_cache: **Return stale Account{...}**
iam_cache -> iam_cache: **SetFallbackMode(true)**
iam_cache -> stats: **Set FallbackActive = true**
iam_cache --> api: **Return Account (with fallback warning)**
```

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–∞:**
1. **–°–µ—Ä–≤–∏—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω** - IAM —Å–µ—Ä–≤–∏—Å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É
2. **Fallback –ø–æ–∏—Å–∫** - –ø–æ–∏—Å–∫ –≤ —Ä–µ–∑–µ—Ä–≤–Ω–æ–º –∫—ç—à–µ
3. **Stale data** - –≤–æ–∑–≤—Ä–∞—Ç —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö, –Ω–æ –≤–∞–ª–∏–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
4. **–†–µ–∂–∏–º fallback** - –∞–∫—Ç–∏–≤–∞—Ü–∏—è –∞–≤–∞—Ä–∏–π–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
5. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - –æ—Ç–º–µ—Ç–∫–∞ –æ–± –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ fallback
6. **–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ** - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö

**–¶–µ–ª—å:** –ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã.

#### üîÑ Scenario 4: Cache Invalidation
```plantuml
== User Account Update ==
admin -> iam_cache: **UpdateUserAccount("user123", newProps)**
iam_cache -> base_iam: **UpdateUserAccount("user123", newProps)**
par Invalidate Primary Cache
    iam_cache -> primary: **Invalidate("^user:user123$")**
    primary -> primary: **Remove matching entries**
and Invalidate Fallback Cache
    iam_cache -> fallback: **Invalidate("^user:user123$")**
    fallback -> fallback: **Remove matching entries**
end
```

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–∞:**
1. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** - –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –∏–∑–º–µ–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ
2. **IAM –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** - –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –≤ –±–∞–∑–æ–≤–æ–º —Å–µ—Ä–≤–∏—Å–µ
3. **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è** - —É–¥–∞–ª–µ–Ω–∏–µ –∏–∑ –æ–±–æ–∏—Ö –∫—ç—à–µ–π
4. **Pattern matching** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π
5. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** - –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö

**–¶–µ–ª—å:** –ü–æ–∫–∞–∑–∞—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫—ç—à–∞.

#### üì§ Scenario 5: LRU Eviction
```plantuml
note over primary: **Cache State:**\nMax Size: 3\nCurrent: [user1, user2, user3]\nAccess Times: [10:00, 10:05, 10:10]

primary -> primary: **evictLRU()**
primary -> primary: **Find least recently used**
note right: user1 (accessed at 10:00)\nis least recently used

primary -> primary: **Remove user1 entry**
primary -> stats: **Increment evictions**
primary -> primary: **Add user4 entry**
note right: **New Cache State:**\n[user2, user3, user4]\nAccess Times: [10:05, 10:10, 10:15]
```

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–∞:**
1. **–°–æ—Å—Ç–æ—è–Ω–∏–µ –∫—ç—à–∞** - –ø–æ–∫–∞–∑–∞–Ω–æ —Ç–µ–∫—É—â–µ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ
2. **LRU –∞–ª–≥–æ—Ä–∏—Ç–º** - –ø–æ–∏—Å–∫ –Ω–∞–∏–º–µ–Ω–µ–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–π –∑–∞–ø–∏—Å–∏
3. **–í—ã—Ç–µ—Å–Ω–µ–Ω–∏–µ** - —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–π –∑–∞–ø–∏—Å–∏
4. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - —É—á–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏—è
5. **–ù–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ** - –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –∫—ç—à

**–¶–µ–ª—å:** –ü–æ–∫–∞–∑–∞—Ç—å —Ä–∞–±–æ—Ç—É LRU –∞–ª–≥–æ—Ä–∏—Ç–º–∞.

#### üè• Scenario 6: Health Monitoring
```plantuml
loop Every 30 seconds
    monitor -> iam_cache: **IsHealthy()**
    iam_cache -> base_iam: **ListUserAccounts()**
    alt Service Healthy
        base_iam --> iam_cache: **Success**
        iam_cache -> iam_cache: **SetFallbackMode(false)**
        note right: Service is healthy\nNormal operation
    else Service Unhealthy
        base_iam --> iam_cache: **Error**
        iam_cache -> iam_cache: **SetFallbackMode(true)**
        note right: Service is down\nFallback mode active
    end
end
```

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–∞:**
1. **–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞** - –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
2. **Health check** - –ø—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å –∫ IAM —Å–µ—Ä–≤–∏—Å—É
3. **–£—Å–ª–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞** - —Ä–∞–∑–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è –∑–¥–æ—Ä–æ–≤–æ–≥–æ/–Ω–µ–∑–¥–æ—Ä–æ–≤–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
4. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ** - —Ä–µ–∂–∏–º–æ–≤ —Ä–∞–±–æ—Ç—ã
5. **–ù–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –≤ —Ü–∏–∫–ª–µ

**–¶–µ–ª—å:** –ü–æ–∫–∞–∑–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∑–¥–æ—Ä–æ–≤—å—è.

### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ñ–∞–π–ª–∞

1. **–°—Ü–µ–Ω–∞—Ä–∏–∏** - 6 —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
2. **–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è** - –ü–æ—à–∞–≥–æ–≤—ã–µ –ø–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö
3. **–ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º** - –ü–æ–∫–∞–∑ concurrent –æ–ø–µ—Ä–∞—Ü–∏–π
4. **–£—Å–ª–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞** - Alt/else –±–ª–æ–∫–∏
5. **–ê–Ω–Ω–æ—Ç–∞—Ü–∏–∏** - –ü–æ—è—Å–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏

---

## üé® –°—Ç–∏–ª–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ PlantUML —Ñ–∞–π–ª–æ–≤

### –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞
- **–ì–æ–ª—É–±–æ–π (#F0F8FF)** - –ù–æ—Ä–º–∞–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (cache hit)
- **–ó–µ–ª–µ–Ω—ã–π (#F0FFF0)** - –£—Å–ø–µ—à–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (cache miss success)
- **–ö—Ä–∞—Å–Ω—ã–π (#FFF0F0)** - –ê–≤–∞—Ä–∏–π–Ω—ã–µ —Å–∏—Ç—É–∞—Ü–∏–∏ (fallback)
- **–ñ–µ–ª—Ç—ã–π (#FFFACD)** - –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (invalidation)
- **–§–∏–æ–ª–µ—Ç–æ–≤—ã–π (#E6E6FA)** - –°–∏—Å—Ç–µ–º–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (LRU)
- **–ú—è—Ç–Ω—ã–π (#F5FFFA)** - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (health check)

### –¢–∏–ø–æ–≥—Ä–∞—Ñ–∏–∫–∞
- **–ñ–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç** - –í–∞–∂–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏ –º–µ—Ç–æ–¥—ã
- **–ö—É—Ä—Å–∏–≤** - –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ –ø–æ—è—Å–Ω–µ–Ω–∏—è
- **–ú–æ–Ω–æ—à–∏—Ä–∏–Ω–Ω—ã–π** - –ö–æ–¥ –∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
- **–£—á–∞—Å—Ç–Ω–∏–∫–∏ (participants)** - –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã
- **–ê–∫—Ç–∏–≤–∞—Ü–∏—è (activate/deactivate)** - –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ –æ–ø–µ—Ä–∞—Ü–∏–π
- **–ó–∞–º–µ—Ç–∫–∏ (notes)** - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ—è—Å–Ω–µ–Ω–∏—è
- **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã (alt/else)** - –£—Å–ª–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
- **–ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º (par/and)** - Concurrent –æ–ø–µ—Ä–∞—Ü–∏–∏
- **–¶–∏–∫–ª—ã (loop)** - –ü–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –æ–ø–µ—Ä–∞—Ü–∏–∏

---

## üîß –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### –î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–∏–∞–≥—Ä–∞–º–º
1. **VS Code** —Å PlantUML extension
2. **IntelliJ IDEA** —Å PlantUML plugin
3. **Online PlantUML Server** –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞

### –î–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **syntax highlighting** –¥–ª—è PlantUML
2. –í–∫–ª—é—á–∏—Ç–µ **live preview** –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
3. –ü—Ä–∏–º–µ–Ω—è–π—Ç–µ **auto-formatting** –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏

### –î–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
1. –ì–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ **PNG/SVG** –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **PlantUML includes** –¥–ª—è –º–æ–¥—É–ª—å–Ω–æ—Å—Ç–∏
3. –°–æ–∑–¥–∞–≤–∞–π—Ç–µ **index –¥–∏–∞–≥—Ä–∞–º–º—ã** –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

---

## üìö –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–°–æ–∑–¥–∞–Ω–Ω—ã–µ PlantUML —Ñ–∞–π–ª—ã –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç:

1. **–ü–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ** –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã Task1
2. **–†–∞–∑–ª–∏—á–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏** - –æ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–æ –∫–æ–¥–∞
3. **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏** - —Ä–µ–∞–ª—å–Ω—ã–µ –ø–æ—Ç–æ–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
4. **–í–∏–∑—É–∞–ª—å–Ω—É—é —è—Å–Ω–æ—Å—Ç—å** - –ø–æ–Ω—è—Ç–Ω—ã–µ –¥–∏–∞–≥—Ä–∞–º–º—ã
5. **–¢–µ—Ö–Ω–∏—á–µ—Å–∫—É—é —Ç–æ—á–Ω–æ—Å—Ç—å** - —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

–≠—Ç–∏ –¥–∏–∞–≥—Ä–∞–º–º—ã —Å–ª—É–∂–∞—Ç –∫–∞–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π, —Ç–∞–∫ –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–º –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –∏ —Ä–∞–∑–≤–∏—Ç–∏—è —Å–∏—Å—Ç–µ–º—ã enhanced caching.